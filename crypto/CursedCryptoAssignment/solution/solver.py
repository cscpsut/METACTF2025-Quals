from Crypto.Util.number import long_to_bytes as l2b, bytes_to_long as b2l
from sage.all import *
from randcrack import RandCrack

N = 600816235961883844896922719874084107675992258921334775659500095855708149412667300989052239308620990650372652353453624491268241730500419995423359410584762557106139116594991726594395295661642767991176293839020521131656755396372551841780258040699512170439198074456853089504809928256544885995944979909857506407589037729112914550338806949445804678932639561018324612417208855403130768589995818593673744310097790162637774399043961211292410450600815796427438880873086170437738513414019932495325312010893433397614171575273560626664101414648481691021222896484463027910771313037151213861924140544644866943807041814586819850562880955556668143665701599314200443315313044215655241510585876658302832948349449056272699935093681187101359409234139911644339944419285053592850405755052106436067884021532433585838281801767751232771386054404758829849477615901102770321733697982344572434853286019966258410250778334891634272308588348876741043152461577313557530004138874045823669466804666659111896627628302875831534028756196124237802046463052706079925782709181559690450783857598433187640180741681778329515297792734452633382276634955744379174114761787114127771538813852449902970513904671129927259637313395955276015510950699609997083499110952792077269764833539
c1 = [156587308631994187049497760845299635064200259012530871815588560138473018608075299667328603968510789191518610839638187628880300706695619780587567636182463965308771896975403925523660360673226398572719463805784386104010667081142311773072898941453300349241928593911432114182934927245324162384714621053384609774570129340104500232881108216194905998160961639768597279416563982990528535053437654600025262784950396081202692922523948562700054938410846294302095877713563550777345305896853876925175447249854985777060969187229169231487051494976268084889538173267598691896780594620603507104418114952565265400172275412729181154834822667382625650111867946879206990128837017848809362846154024713629630727305134301096434232702577539212884743722882788148026997580371177863958666917479263247327887099668192040722259745069151899222867561969058117359771253225364439197414867294103464063591868091261621082284876549431417663925726855148959474593829480156189625415443328036243428992340802664538880788849938646764948078802858317819824073842056077234549117646026470701329216567845516008311366227905528331288145720717430799546418399777680723678981320247442970184662487962262509451773051932948590077429566698394063012917177680832193415562681189743527987129594102, 343722121435689170731849096179472519715390905286145899720601344695639173682908176016610289272788662473646417182588188979924831726324401729761828662094666821161858298010315338137273084361844396766287474639558712753491442428329674783264841483377368303346207547473939694004497142898229305624091667830717285521969563532324033659583643834165724521313387717415501381102591089281048103695194134577583159314929999056974867396956434553804793725684595376013430479849467649982088375033958323419875837775504278343374103050048779774018253559667192968396841663095910810395138216820057497199539570254385932160429128966246090402091176086014446576076030343145828587564362224563466329582000919919768965357586684654282712743403499703206449255517862131246893551701061357270061126277116122065200328121363521919536745089509895180511902845623220504331848025328526431663282017640680019151983971859835422024265091623661442210886578963386986288524845804937665846585342934667690646261973274760466850014382062183408264672372638400291223890327805989056526257476905746886509455753028695026786635021064617927759234244585974643284189729280363245692307691289800662449334691472342138592651825765372380756573648439732457362097106710295568948443262079685257039779141404, 240863657094286802980706660531282299949524242031270636015686274717563148125702056502625038211386744415150108053986008124817527562553004085612760889732126732920759728947762794651121854718258661131629094150191103755026159284701440800080488942386073663340678587013090229582554836518255515968871856898805088857880688920695577651252762322924091636969038179085538297032981805328017432162687420806260226464149069269913797941993638014489455851906069964780349235583734157573107903824302858627668890939591189840386930212748763486592952051322411419877588411556959797812986881825949617912613687532660216351501811966554464807009179926437941923994180587957101620576442441212484123144222666103441312604990543664160854356734319207570163943514838741746734452400965257711369442910513439694366340130914596096092517642778780136976553186076408112601856610654230887308860313378536062860832528438092453024224830863819129045917004636985590382272574054275775992945297306239251250296095249082177905452768329233236758068486005319420445444500372772937388100039466068804408432757723294963818385361808659480542966370261382377676189574655756471636905120028483502676684916874840031283904768995664239835873703135008358331642063065120845543194073885148067879260174376, 447196455102319207545935587269136686425372392678469308240061684641855000249644104322680518737887777489699111280976449720845449356065422776110187712492641474087448549854182998116199578258238031315937382686326944110704950462814923268023228350897845868269064569935940725327480191395724143186705153766447822365193180961039501805007025606683247752028088152561502395927532005306976793104279829669096999839374877900275413843973349479658752374093544262649027878508145458157564729714466502379861642633478384185937609753977406523333247878248842095398871698143960879932932867864554630642502334168068174495565421512945438032270825226007593878977431002033366344783201244695582734293384160635407983848213306461631001713550894003533893789613955827647076582884249224511689469032307969491814631496078548397909096117755752558570956259604084032557714111309179169745074570439791916136492496011955488883059147504220062524314007544612578628390034778602257095538176743032584267809883134882830184582580931282529009131333565297878451678074398129497963492274039693424910010412173811614532766953601653460347791308200773706728823257802610562115745647224186427015013468374564791348293095412415007862817108835348266291845808751189034256054801075372698628388555251]
c2 = [359806803885339694671019062928160516096293279764062803865385069894206033953277374761723317959731269172798490169138284668225017898632032215502702358271042327531568984193997553297605740355233896029717461171244291868184027777074510390144013358718369139166677686438108742723967157972757112550546630636375628632582722873436823212998058664638353380843468800417315414210975582180893226892240538529563021088116727719413188050460503954119540792900645538721024634044093662983756873135172116863523471512237297001092765335906417812113926949893541443913953872177802609085934690889061204858699622662765390999328567632552111462452842615005095787706361702600048303943178047103765892254190005070433315823416088642222690268057920608196092302395292753910775181306450078249373034237254455290671425829386245591380919691929043622537119582780482825577462080975107873848621350211033571652455707219967103027860408859728018619862356142516500355010540239600824610756800255483048101717296861507442901735186381640674674234356384332059683942383406958143535157128810791827046189367162585923848619173977837199534718842803624008181657116140633091202611326473840054855898938335813935374239591961029890378655530198028422834298411386635682338970702826464200107584507521, 252038993907618859618378540705679713193132837972087850443684187882890862322740638735758121120434311001890796682032449614662744404802543353682656797170038506710066062922077239824761653672754219748819392216235375433366786259066798045295606209744366332617179705154785148144244814800418004831032280502877543506657416172456705003279036735832305500144957981175806833114862098289573549066230487249166730854066710601038108413582228230599188352176551670423924578137277789005813704852454138720629796309620288505010367071138680844860008391836882856614023638769233810126128099780971068478902183884396311800858205573186237888944607906880444341121455161302285591647475862124159126492224142685776665071797455903302458466735956688936076347706251732171180051820326377923642881735846201802794732717598191725663471867047349926213519922918992991725173057953008049950185728452037997601291031835571711048484660567604878679818550960298243417095538726871597341307747059096757517645079628713088547709711591347223767406218056462959556617469429747631550375947538646315155602120997418494552448143324250591345088414640988723244443230586920122833559347197730328308473803502060280392618789174150341474263997106776175506335945242226373786025403779790819654842154086, 100187604800807581127814578389999302127141916613420717640218874323465052030515316569572482810348781871126000161990654325335960927096025864940289858286165545047191985685430028063078797199796709930600795051853986488792533819616011730268322156638812020648188104065693344724909714942796409462160287230478915624356506965788171721919946059669631691551703546362562191621032026889373985736078522268562593868589200505833146291183509809788538706544691624260788598021361204837864878121271825340826029555079520558479052883274817177980117319981270698025042428137972128910079295277934300788708558213110322100398011315463983265062088368698627679769615934432444402466449982678485786996398411749934038016939915817622035190265628746027841434373958541809815628213248674023557993462876710023232772631881557689635204949378867321665171815160535532964734238189651771127590850086797734513602885367715219163969692595531343548125612806147350468008226233192396607802127317675449757034353914822943392016624838682866365907598862255917000980513386581251075482215527476119077294464577437094626656650281346515470539663257599701540670002099417154171403057014495164552267806876210363423963018072577438830018959877375893168097911931353157517318595791892441004820907014, 195721573524288982722389230763320876057899584691596599896804392743511872388306499882746214500871836445055576332547668431473444887935909678243242151478738625420022431142101153303754707798779307418353030179921933450936292384873699901915746200762910692304554029930929746253973915947584066697307354921684284578439945192965972806824896244048919690659106077583387900879322522338752113828902556898726790692808953471689042631559298308802223639946299371024383227289663347188375169219249006575786948702742154790991437468097682828872623493738449952299092862499269600330130547482040826232545240106416978098657429430453448591655879634757733673578324299871030639650593025380934534966160282974631668947857240360704439442002498759062680626320593791630425933180554754977221880888049305313856856097258144666656872311815645141489843094444750833454880748782547086250161113533343040415811136893909119921803964511984148278620755343277612239780197673798721981183423991866720786577513603205496163237717400867425680045088015432953490567976738823068998552696302560998957596955305885657822289585226394750042873287618447379169709126738303453581101357138987780782931755589874982433118130794591621458841665132620190807408553825318315575493290951073941994834177360]
e1 = 4168976047 * 120
e2 = 4245000449 * 33
hint = [142821401883834901566946325287124115984248332657624203263581280817283091023828335120828229456052435422441100720797039612678303587715942560013732747975618610747260606681193557060793918111984521415960983481754288929059909952335349314911463267794898256499827061381700204667214329693764325170992384662138019691134, 65342602115441640356507212297502844460279737320427697318770168875148447190209179762641450685825174992454765369019499478368780546836194136888107379735531529328713074439715722369187810786410549838293116032243503716644598695742662498818627607122472098454638307530793053895598040559013293522565243767385147219077, 24128045133228983186425177008769787527826216554219447295848388717565947001237315318959802168779199341034620155328215700438965271860404113149439470514832678095600090386163925076257210870435190542350588806733524549584938338197854543050054042799317289875107437796193283287293183630657796925041549020839695620884, 79267599577642947076156457721929348249722401567453033719160664194539851579945628330566585945904601894800508505868733718808929987679728661512736965728036502982184689932865134928938593407486290776565447149662622231515420622253912416647907911758732888964137273630062427842502576782039175918268329016099234171900, 172119210831901431725624487520122286319493079591921312421580271643852276107772117438965792827600700527136958937702195757722892169439441526318847845303662902172064123819790933592858154123681035055660920282239870173481045590687327403456405234451434203894977244485643915636825028288489229879210867887555830893926, 8968473347820843538506345548605842698220778357379599958179740788054749460934740825233662914503114934647728249466887315202509112712448190414924826317338597813821792278396886346265433724066741582653933639458428553146389937942046573448937703463668069604593672550018019264281090362025803398605560093746959415307, 126971094711634057996955872241527948288270792123686512071232342406288168760257066175351209072654921478844658270621294598108597067454690499771223753460972057975192424302491644084196962307253973947615497835668702692344499269796826196850715907077057863019414542147936326001199383419460241125506943320460952303097, 18867255553960950649011861141579771581139427021559908304669463443421076003499022755697186194266270853345858766477726015152995106877496006581591942221168771216252961925676459260229112886028106602462243630421540370985524793172780481702152641448960275284366224232194185998876822516356656406927774809668218684088, 128115170093604024359386352641623549613647511404354924956943800158360132161251843971521180430254506311516082482518340064333652451766788134674111631076627757141709741896691353065533179186042913936377513496398783949962637277347668445283614722952624860542441330144287165628318417472135995836845387784948803834241, 175808389604464071339468805608113888759933981160396491825938924199126707201291886706652225928486970680887524254198886756200595083247385532400216983481604390320676401920073017678235387932193797513087840320189991365022991208861806695372196559963992380251314022633895527083918849515845118395197045206593437932935, 164899574499915235162233501375387463992478688211158998444226047716418180027506980378761126738111211837416402275369201615553426752852469765539071842557720724016310292025318983070422259240169200873900221301372676712909599173319877014460336257999919244977666478814088422877123015524040193203855501042065540912759, 56095174049130830655165793668889361622928210465268189397818283956716244869076525088616457674784365243156872896858929598095416907735230949210016204395334291260179224442760125773768201590704369820219123200346528750307765569245097470003987048152932354816605030937026832252083054753423585417126568751079223498417, 149377608533215084196815894898314496492049575741502552129249737641731293267406752564898001003252496746399029227406059235941643266538606152830234708373591783513677812631279408316659862368792782738270435364354282816951485254400360846344283711873628959618952516855495280431219202002769030184972606137228722343399, 18148801687951153265795777073392118400481124841429050282963786568249230887465629538151004088220583580293052666268476516700980159197578636186675547237861439827996741555201662169633573124703791432497347092509542478225803193632658443063656888975284086014557983681304830847877728436990769551176920621594600246053, 26822921629743181933216324988253474991754636716523386552499240980000231273510568937081558279941714316897756257976161139410671300807735759503008246619187300537557868601616003064227772627761425147059813801573011389308258947960941651455231309414700329502391276462351931231436504041441315903715767657427493296657, 93816703909902872176042786102806497432539061131011943611756952526728751081895635757593199304005880759724325978132314914927478392132242964051278481664860955672119136794317288871352351696423322995051640560049293736697862901277276207817665572120483628736047975163493451804717579800535910141602787681651635302782, 52116848843167949400705544090238421735655781719038347508077141012562779147044174732638456219824733077320254645526117451858783102927376624715692654071329603218684094431166066402151088012625027709709149615502385992649572624972769508963976718950218114626627644361144516949903021382305386266613208564050195407382, 25886982340219391175177413621388795699538636971650079769802634509471311363965029560288386923061072179691546663969628009489708608456954469398471065960380205714114304166148782468885642112071362564184817027240246361333834652643469359092017051687054271279234875112651218477167608949802811832768984508513429383315, 26269883157303767735509728174492128587956181024945874279550968350638405408767358581274408924353307257508002781691371648768742635911360348900599777743233957078117241836687299298546589437688328102350385628899500971469467545302318347643071283232738261876034801544891120697275888001443764982169467579095175705475, 16039281962389638039882809567495662958754227721559209689921922254869406797480331828780902078093714641360587228203953655909690281372789791228715513186856472089391806318058484969492062211208498270330325697003165051865969859175638197775170619685210673627236912274459848536688330639583135288444662964708356604990]

def CMA(e1, e2, c1, c2, N):
    def extended_euclidean(a, b):
        if a == 0:
            return b, 0, 1
        gcd, x1, y1 = extended_euclidean(b % a, a)
        x = y1 - (b // a) * x1
        y = x1
        return gcd, x, y

    g, a, b = extended_euclidean(e1, e2)

    # Since e1*a + e2*b = g = 3
    m_a = (pow(c1, a, N) * pow(c2, b, N)) % N  # = flag^3 mod N
    return m_a


def crack_padding(val_list: list)-> list: 
    rc = RandCrack()

    def extract32(val):
        byte_val = l2b(val)
        array_32 = [ byte_val[i:i+4] for i in range(0, len(byte_val), 4) ]
        array_32.reverse()
        return [ b2l(x) for x in array_32 ]

    values = []
    for i in range(20):
        values.append(extract32(val_list[i]))

    bits = 0
    for i in values:
        for j in i:
            try:

                bits += j.bit_length()
                rc.submit(j)

            except Exception as e:
                break
    for i in range(16):
        rc.predict_getrandbits(32)
    pads = []
    
    for i in range(len(c1)):
        pads.append(l2b(rc.predict_getrandbits(496*8))[::-1])
    pads = [ b2l(x) for x in pads ]
    return pads


pads = crack_padding(hint)

cts = []


for i in range(0, len(c1)):
    cts.append(CMA(e1, e2, c1[i], c2[i], N))
    


for i in range(len(cts)):
    S = pads[i]
    A = (S * pow(256, 16, N)) % N
    PR = PolynomialRing(Zmod(N), 'x', implementation='NTL')
    x = PR.gen()
    f = PR((x + A )**3 - cts[i])
    pt = int(f.small_roots(X=2**128, beta=1, epsilon = 0.05)[0])
    pt = l2b(pt).replace(b'B',b'').strip()
    print(pt)

print()